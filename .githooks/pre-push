#!/bin/bash
# Pre-push hook: auto-formats code, then runs clippy and tests before allowing push

set -e

echo "Running pre-push checks..."

# Auto-format code before running checks
echo "Formatting code..."
cargo fmt

# Run clippy
echo "Running clippy..."
if ! cargo clippy -- -D warnings; then
    echo ""
    echo "ERROR: Clippy found issues. Fix them before pushing."
    exit 1
fi

# Run tests (skip db tests as they require PostgreSQL)
echo "Running tests..."
if ! cargo test --lib -- --skip db::; then
    echo ""
    echo "ERROR: Tests failed. Fix them before pushing."
    exit 1
fi

echo ""
echo "All pre-push checks passed!"
